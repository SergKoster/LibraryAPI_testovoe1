# Инструкция по запуску

## 1. Клонируйте репозиторий
Сначала надо клонировать репозиторий. Так вы получите сам проект. 
```bash
git clone https://github.com/SergKoster/LibraryAPI_testovoe1.git
cd LibraryAPI_testovoe1
```
## 2. Создайте и активируйте виртуальное окружение
```bash
python -m venv venv
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate
```
У вас может не работать activate, если вы используете powershell,пропишите:
```bash
venv\Scripts\activate.ps1
```
## 3. Установите зависимости
```bash
pip install -r requirements.txt
```
## 4. Настройте .env
`.env` - это файл, содержащий информацию, нужную для работы базы данных, токенов jwt и подобных утилит
```bash
SECRET_KEY=your_secret_key
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your_password
POSTGRES_DB=library_db
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
```
Это только пример! Прописывать данные нужно в соответствии с Вашим проектом, в данном случае показаны все нужные поля, которые нужно заполнить, для корректной работы проекта.

## 5. Миграции
```bash
alembic upgrade head
```
Данное действие нужно для того, чтобы все таблицы корректно создались в базе данных.

## 6. Запуск сервера
```bash
uvicorn main:app --reload
```

## Запуск тестов
Чтобы запустить тесты, достаточно прописать данную команду в корне проекта:
```bash
pytest
```

# Описание структуры проекта

Проект составлен по такой структуре:
```bash
.
├── app/                     # Основной код приложения
│   ├── api/                 # Роутеры FastAPI (users, books, borrows, readers, auth)
│   ├── core/                # Базовые настройки, конфиги, база данных
│   ├── crud/                # CRUD-логика для работы с БД (отдельно для каждой сущности)
│   ├── models/              # SQLAlchemy модели
│   ├── schemas/             # Pydantic-схемы (валидация и сериализация)
│   └── migrations/          # Alembic — миграции для БД
├── tests/                   # Тесты (Pytest)
├── main.py                  # Точка входа в приложение (FastAPI instance)
├── alembic.ini              # Конфиг Alembic для миграций
├── requirements.txt         # Список зависимостей
├── .env                     # Переменные окружения (не входит в git)
└── README.md                # Описание проекта и инструкция по запуску

```

# Структура БД

4 таблицы
- users |    Таблица пользователей (библиотекарей) | Поля: id, email, hashed_password
- books |    Таблица с книгами | Поля: id, title, author, year, isbn, copies, description(поле нигде не используется, нужно для демонстрации alembic миграции)
- readers |  Таблица с читателями | Поля: id, name, email
- borrows |  Таблица с записями о том, какие читатели взяли какие книги | Поля: id, book_id, reader_id, borrow_date, return_date

Такая структура показась мне самой простой для базы данных, она соответствует всем требованиям ТЗ.

# Бизнес логика

## 1. Книга выдаётся, только если кол-во её копий больше 0

Когда в API посылается запрос на выдачу книги читателю, сервер проверяет количество доступных копий (поле copies, таблица books) у нужной книги. Если копий 0, сервер возвращает ошибку, если копий больше 0 (хотя бы 1), сервер записывает в БД запись о том, что пользователь взял книгу, а так же вычитает 1 из столбца copies у соответствующей книги. Это означает, что, когда читатель берёт книгу, кол-во доступных копий этой книги в базе данных уменьшается на 1 (поле copies, таблица books).

## 2. Книга не выдаётся, если пользователь уже взял её


